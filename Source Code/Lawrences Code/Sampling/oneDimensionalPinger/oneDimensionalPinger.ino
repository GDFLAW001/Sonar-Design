#include <ADC.h>
#include <DMAChannel.h>

//Set up chirp
static volatile uint16_t chirp[7605]={4095, 4078, 4027, 3944, 3829, 3684, 3512, 3316, 3098, 2864, 2615, 2358, 2095, 1831, 1571, 1319, 1079, 855, 651, 470, 315, 189, 94, 31, 2, 7, 46, 118, 222, 356, 519, 707, 917, 1146, 1390, 1645, 1907, 2171, 2432, 2688, 2933, 3163, 3375, 3564, 3728, 3865, 3971, 4045, 4086, 4094, 4067, 4006, 3913, 3789, 3636, 3457, 3254, 3031, 2792, 2541, 2281, 2017, 1754, 1496, 1247, 1011, 792, 594, 421, 274, 157, 72, 19, 0, 15, 64, 146, 259, 402, 573, 768, 984, 1218, 1466, 1723, 1986, 2250, 2511, 2763, 3004, 3229, 3435, 3617, 3773, 3901, 3997, 4061, 4092, 4089, 4052, 3981, 3878, 3745, 3584, 3397, 3187, 2959, 2715, 2461, 2199, 1935, 1673, 1417, 1172, 941, 728, 538, 372, 235, 127, 52, 9, 1, 27, 86, 178, 301, 453, 632, 834, 1057, 1295, 1547, 1807, 2070, 2334, 2592, 2842, 3078, 3297, 3496, 3670, 3817, 3935, 4021, 4075, 4095, 4081, 4033, 3951, 3839, 3696, 3526, 3331, 3115, 2881, 2634, 2376, 2113, 1849, 1589, 1335, 1094, 869, 663, 480, 324, 196, 99, 34, 3, 6, 43, 113, 215, 348, 510, 697, 906, 1134, 1378, 1633, 1894, 2159, 2421, 2677, 2923, 3154, 3366, 3557, 3723, 3860, 3968, 4043, 4086, 4094, 4068, 4009, 3917, 3793, 3641, 3462, 3260, 3037, 2798, 2547, 2287, 2023, 1759, 1501, 1251, 1015, 796, 597, 423, 276, 159, 73, 19, 0, 15, 63, 145, 258, 401, 572, 767, 984, 1218, 1466, 1724, 1987, 2251, 2512, 2765, 3006, 3231, 3436, 3618, 3775, 3902, 3998, 4062, 4092, 4089, 4051, 3980, 3876, 3742, 3580, 3393, 3183, 2954, 2710, 2454, 2193, 1928, 1666, 1410, 1165, 934, 722, 532, 367, 230, 124, 50, 9, 1, 29, 89, 183, 307, 460, 640, 844, 1067, 1307, 1559, 1819, 2083, 2347, 2605, 2855, 3090, 3309, 3506, 3679, 3825, 3941, 4026, 4077, 4095, 4079, 4028, 3945, 3830, 3685, 3513, 3317, 3099, 2864, 2615, 2357, 2094, 1830, 1569, 1316, 1076, 852, 648, 467, 312, 187, 92, 30, 2, 8, 48, 121, 226, 362, 526, 715, 927, 1157, 1402, 1658, 1920, 2184, 2447, 2702, 2947, 3176, 3387, 3576, 3738, 3873, 3977, 4049, 4088, 4093, 4063, 4000, 3904, 3777, 3622, 3440, 3235, 3010, 2769, 2516, 2255, 1991, 1727, 1469, 1221, 986, 769, 574, 403, 259, 146, 64, 15, 0, 19, 73, 159, 276, 424, 598, 796, 1016, 1252, 1502, 1761, 2025, 2289, 2549, 2801, 3040, 3263, 3465, 3644, 3796, 3919, 4010, 4069, 4094, 4085, 4042, 3965, 3857, 3718, 3551, 3360, 3146, 2914, 2668, 2411, 2148, 1883, 1622, 1367, 1123, 896, 687, 501, 341, 209, 108, 40, 5, 4, 37, 104, 203, 333, 492, 677, 884, 1112, 1354, 1608, 1870, 2135, 2398, 2655, 2902, 3135, 3350, 3543, 3711, 3851, 3961, 4039, 4084, 4094, 4071, 4014, 3924, 3802, 3651, 3474, 3272, 3051, 2812, 2561, 2301, 2036, 1772, 1513, 1262, 1025, 805, 605, 430, 281, 162, 75, 21, 0, 14, 62, 142, 255, 398, 568, 763, 980, 1214, 1462, 1720, 1984, 2248, 2509, 2763, 3004, 3230, 3436, 3618, 3775, 3902, 3999, 4062, 4093, 4088, 4050, 3979, 3875, 3740, 3577, 3389, 3178, 2948, 2704, 2448, 2185, 1921, 1658, 1402, 1156, 926, 714, 525, 361, 225, 120, 47, 7, 2, 31, 93, 188, 315, 470, 652, 857, 1082, 1323, 1576, 1837, 2102, 2365, 2624, 2872, 3107, 3325, 3521, 3692, 3836, 3949, 4031, 4080, 4095, 4075, 4022, 3936, 3818, 3670, 3495, 3296, 3076, 2839, 2589, 2329, 2065, 1801, 1541, 1289, 1050, 827, 625, 447, 295, 173, 83, 25, 1, 11, 55, 133, 243, 383, 550, 743, 958, 1191, 1438, 1695, 1959, 2224, 2486, 2740, 2983, 3210, 3418, 3603, 3762, 3892, 3991, 4058, 4091, 4090, 4055, 3986, 3884, 3752, 3592, 3405, 3196, 2967, 2723, 2468, 2206, 1941, 1678, 1421, 1174, 943, 729, 538, 372, 234, 126, 51, 9, 1, 28, 88, 181, 305, 459, 639, 843, 1067, 1307, 1560, 1821, 2085, 2349, 2608, 2858, 3094, 3313, 3510, 3683, 3828, 3944, 4028, 4078, 4095, 4077, 4026, 3941, 3824, 3678, 3505, 3307, 3087, 2851, 2601, 2342, 2077, 1813, 1552, 1300, 1060, 836, 633, 454, 301, 178, 86, 26, 1, 10, 53, 130, 238, 377, 544, 736, 950, 1183, 1430, 1687, 1951, 2216, 2478, 2733, 2977, 3204, 3413, 3599, 3758, 3889, 3989, 4057, 4091, 4091, 4056, 3988, 3887, 3755, 3595, 3409, 3200, 2971, 2727, 2472, 2210, 1945, 1681, 1424, 1177, 945, 731, 540, 373, 235, 127, 52, 9, 1, 27, 88, 181, 305, 458, 639, 842, 1066, 1307, 1560, 1821, 2086, 2350, 2609, 2859, 3095, 3314, 3511, 3684, 3829, 3945, 4028, 4079, 4095, 4077, 4025, 3940, 3823, 3676, 3502, 3304, 3084, 2847, 2597, 2337, 2073, 1808, 1547, 1295, 1055, 832, 629, 450, 298, 175, 84, 25, 1, 11, 55, 132, 242, 382, 549, 742, 957, 1190, 1438, 1696, 1960, 2225, 2487, 2742, 2985, 3212, 3420, 3605, 3764, 3894, 3993, 4059, 4092, 4090, 4054, 3984, 3882, 3749, 3587, 3400, 3189, 2960, 2716, 2460, 2197, 1932, 1668, 1411, 1165, 934, 721, 530, 365, 228, 122, 48, 8, 2, 30, 92, 187, 313, 469, 650, 856, 1081, 1322, 1576, 1838, 2103, 2367, 2626, 2875, 3110, 3328, 3524, 3695, 3838, 3952, 4033, 4081, 4095, 4074, 4020, 3932, 3813, 3664, 3488, 3287, 3066, 2828, 2577, 2316, 2052, 1787, 1526, 1275, 1036, 814, 613, 436, 286, 166, 77, 22, 0, 13, 60, 141, 253, 396, 566, 761, 978, 1213, 1462, 1721, 1985, 2250, 2512, 2766, 3008, 3234, 3440, 3622, 3778, 3905, 4001, 4064, 4093, 4088, 4048, 3975, 3869, 3733, 3568, 3378, 3165, 2934, 2688, 2431, 2167, 1902, 1639, 1383, 1138, 908, 698, 510, 348, 214, 112, 42, 5, 3, 36, 102, 201, 331, 490, 675, 883, 1110, 1354, 1609, 1871, 2137, 2401, 2659, 2907, 3140, 3355, 3548, 3715, 3855, 3964, 4041, 4085, 4094, 4069, 4010, 3918, 3794, 3641, 3461, 3258, 3034, 2793, 2540, 2279, 2013, 1749, 1489, 1239, 1002, 783, 585, 412, 266, 151, 67, 16, 0, 18, 70, 156, 273, 420, 595, 794, 1014, 1251, 1502, 1762, 2027, 2292, 2554, 2806, 3046, 3269, 3471, 3650, 3801, 3923, 4014, 4071, 4094, 4083, 4038, 3959, 3848, 3707, 3537, 3343, 3127, 2892, 2644, 2385, 2121, 1855, 1593, 1339, 1096, 869, 662, 479, 322, 193, 97, 33, 2, 7, 45, 118, 223, 358, 522, 712, 924, 1155, 1401, 1658, 1922, 2187, 2451, 2707, 2953, 3183, 3394, 3582, 3745, 3879, 3982, 4053, 4089, 4092, 4060, 3994, 3895, 3765, 3607, 3422, 3214, 2986, 2742, 2487, 2224, 1959, 1694, 1436, 1188, 955, 740, 547, 379, 239, 130, 53, 10, 1, 26, 86, 179, 303, 456, 636, 840, 1065, 1306, 1559, 1821, 2086, 2351, 2611, 2861, 3098, 3316, 3514, 3687, 3832, 3947, 4030, 4080, 4095, 4076, 4023, 3936, 3818, 3670, 3494, 3294, 3073, 2835, 2583, 2323, 2058, 1793, 1531, 1279, 1040, 817, 616, 438, 288, 167, 78, 22, 0, 13, 60, 141, 253, 396, 567, 763, 980, 1216, 1465, 1724, 1989, 2255, 2517, 2771, 3013, 3239, 3445, 3627, 3782, 3909, 4004, 4065, 4093, 4087, 4046, 3971, 3864, 3726, 3560, 3369, 3155, 2922, 2675, 2417, 2153, 1887, 1624, 1368, 1123, 894, 685, 498, 338, 206, 106, 38, 4, 5, 40, 109, 210, 343, 504, 691, 902, 1131, 1376, 1633, 1896, 2162, 2426, 2684, 2931, 3162, 3376, 3566, 3732, 3868, 3974, 4048, 4088, 4093, 4064, 4001, 3904, 3777, 3620, 3437, 3230, 3004, 2761, 2506, 2244, 1978, 1713, 1454, 1205, 970, 754, 559, 389, 248, 136, 57, 12, 1, 24, 82, 172, 295, 447, 626, 829, 1052, 1293, 1546, 1808, 2073, 2338, 2599, 2850, 3087, 3307, 3506, 3680, 3826, 3943, 4027, 4078, 4095, 4077, 4025, 3940, 3822, 3675, 3500, 3301, 3080, 2842, 2591, 2330, 2065, 1799, 1538, 1285, 1045, 822, 620, 441, 290, 169, 79, 23, 0, 13, 59, 140, 252, 395, 566, 761, 979, 1214, 1464, 1723, 1988, 2254, 2517, 2771, 3014, 3240, 3445, 3628, 3783, 3909, 4004, 4066, 4093, 4087, 4045, 3970, 3862, 3724, 3557, 3365, 3151, 2918, 2670, 2412, 2147, 1881, 1618, 1362, 1118, 889, 680, 494, 334, 203, 103, 36, 4, 5, 41, 112, 214, 348, 511, 699, 911, 1141, 1387, 1644, 1908, 2174, 2438, 2695, 2942, 3173, 3386, 3575, 3739, 3875, 3979, 4051, 4089, 4092, 4061, 3996, 3898, 3768, 3610, 3425, 3217, 2989, 2745, 2489, 2226, 1960, 1695, 1436, 1188, 954, 739, 545, 378, 238, 129, 52, 10, 1, 27, 88, 181, 306, 461, 642, 847, 1073, 1315, 1569, 1831, 2097, 2363, 2623, 2873, 3109, 3327, 3524, 3695, 3839, 3953, 4034, 4082, 4095, 4073, 4018, 3929, 3808, 3657, 3479, 3277, 3054, 2815, 2562, 2300, 2034, 1769, 1508, 1256, 1017, 797, 597, 421, 274, 156, 70, 18, 0, 17, 68, 152, 269, 416, 590, 789, 1009, 1247, 1499, 1759, 2025, 2291, 2553, 2806, 3047, 3270, 3473, 3652, 3803, 3925, 4015, 4072, 4095, 4082, 4036, 3956, 3843, 3700, 3529, 3333, 3115, 2880, 2630, 2370, 2105, 1838, 1576, 1321, 1079, 853, 647, 465, 310, 184, 89, 28, 1, 9, 51, 127, 236, 375, 543, 736, 951, 1185, 1433, 1692, 1957, 2223, 2487, 2743, 2987, 3215, 3424, 3609, 3768, 3897, 3996, 4061, 4092, 4089, 4051, 3979, 3874, 3739, 3574, 3384, 3172, 2940, 2693, 2435, 2171, 1904, 1640, 1383, 1137, 907, 695, 507, 345, 212, 110, 40, 5, 4, 38, 106, 207, 339, 499, 687, 897, 1127, 1372, 1629, 1893, 2159, 2424, 2682, 2930, 3162, 3376, 3567, 3732, 3869, 3975, 4049, 4088, 4093, 4063, 3999, 3902, 3773, 3616, 3431, 3223, 2996, 2752, 2496, 2233, 1966, 1701, 1442, 1193, 958, 742, 548, 380, 240, 130, 53, 10, 1, 27, 87, 181, 306, 461, 642, 847, 1073, 1315, 1570, 1833, 2099, 2365, 2625, 2875, 3112, 3330, 3526, 3698, 3841, 3954, 4035, 4082, 4095, 4072, 4016, 3926, 3804, 3653, 3474, 3271, 3047, 2806, 2553, 2290, 2024, 1758, 1497, 1246, 1008, 787, 588, 414, 267, 151, 67, 16, 0, 19, 72, 158, 277, 425, 602, 802, 1024, 1263, 1516, 1777, 2043, 2310, 2571, 2824, 3064, 3286, 3488, 3665, 3814, 3934, 4021, 4075, 4095, 4080, 4030, 3947, 3832, 3686, 3512, 3314, 3094, 2856, 2605, 2344, 2078, 1812, 1549, 1295, 1054, 830, 626, 447, 294, 172, 81, 23, 0, 12, 58, 139, 251, 394, 565, 761, 979, 1215, 1466, 1726, 1992, 2258, 2521, 2776, 3019, 3245, 3451, 3633, 3788, 3913, 4007, 4068, 4094, 4085, 4042, 3965, 3856, 3715, 3547, 3353, 3137, 2902, 2653, 2393, 2128, 1861, 1597, 1342, 1098, 870, 662, 478, 320, 192, 95, 31, 2, 7, 48, 122, 228, 366, 532, 724, 939, 1172, 1420, 1679, 1944, 2211, 2475, 2732, 2977, 3206, 3416, 3602, 3763, 3893, 3993, 4059, 4092, 4089, 4052, 3981, 3877, 3742, 3578, 3388, 3175, 2943, 2696, 2438, 2173, 1906, 1642, 1384, 1138, 907, 695, 507, 345, 211, 109, 40, 5, 4, 38, 107, 208, 341, 503, 691, 902, 1132, 1379, 1636, 1900, 2167, 2432, 2691, 2938, 3170, 3384, 3574, 3739, 3874, 3979, 4051, 4089, 4092, 4060, 3995, 3896, 3765, 3606, 3419, 3210, 2981, 2736, 2479, 2215, 1948, 1683, 1423, 1175, 941, 727, 534, 368, 230, 122, 48, 8, 2, 31, 94, 191, 319, 477, 661, 869, 1097, 1341, 1597, 1861, 2128, 2394, 2653, 2903, 3138, 3354, 3548, 3717, 3857, 3966, 4043, 4086, 4094, 4067, 4006, 3912, 3786, 3630, 3447, 3241, 3014, 2771, 2516, 2252, 1985, 1719, 1459, 1209, 973, 755, 559, 389, 247, 135, 56, 11, 1, 25, 84, 176, 300, 454, 635, 840, 1066, 1308, 1563, 1826, 2093, 2359, 2620, 2871, 3108, 3327, 3524, 3696, 3840, 3954, 4035, 4082, 4095, 4072, 4016, 3925, 3803, 3651, 3472, 3268, 3044, 2802, 2548, 2285, 2018, 1752, 1491, 1239, 1001, 781, 582, 408, 262, 147, 64, 15, 0, 20, 75, 163, 284, 434, 612, 815, 1038, 1279, 1532, 1795, 2062, 2328, 2590, 2842, 3081, 3303, 3503, 3678, 3825, 3942, 4027, 4078, 4095, 4077, 4024, 3937, 3818, 3669, 3493, 3292, 3069, 2829, 2576, 2314, 2047, 1781, 1519, 1266, 1026, 803, 602, 425, 277, 158, 71, 18, 0, 17, 68, 153, 270, 417, 593, 793, 1014, 1253, 1506, 1768, 2034, 2301, 2564, 2818, 3058, 3282, 3484, 3662, 3812, 3932, 4020, 4075, 4095, 4080, 4030, 3947, 3831, 3685, 3511, 3312, 3091, 2853, 2601, 2339, 2073, 1806, 1543, 1288, 1047, 823, 620, 441, 289, 167, 78, 22, 0, 14, 62, 144, 258, 403, 576, 774, 994, 1232, 1484, 1745, 2011, 2279, 2542, 2796, 3038, 3263, 3468, 3648, 3801, 3924, 4014 , 4072, 4095, 4082, 4036, 3955, 3842, 3698, 3526, 3329, 3109, 2872, 2621, 2360, 2093, 1826, 1563, 1308, 1065, 839, 634, 453, 299, 175, 83, 25, 1, 11, 57, 137, 249, 392, 563, 759, 978, 1215, 1465, 1726, 1993, 2260, 2524, 2779, 3022, 3249, 3454, 3636, 3791, 3916, 4009, 4069, 4094, 4084, 4040, 3961, 3850, 3708, 3538, 3342, 3124, 2888, 2637, 2377, 2110, 1843, 1579, 1323, 1080, 853, 646, 463, 308, 182, 88, 27, 1, 10, 54, 131, 242, 383, 552, 748, 965, 1201, 1451, 1712, 1978, 2245, 2509, 2766, 3009, 3237, 3444, 3627, 3784, 3910, 4005, 4067, 4094, 4086, 4043, 3966, 3856, 3716, 3547, 3352, 3135, 2900, 2650, 2389, 2123, 1855, 1591, 1335, 1091, 863, 655, 471, 314, 187, 91, 29, 1, 9, 51, 127, 236, 376, 545, 739, 956, 1191, 1441, 1701, 1967, 2235, 2499, 2756, 3000, 3229, 3437, 3621, 3778, 3906, 4002, 4065, 4093, 4087, 4045, 3969, 3861, 3721, 3553, 3359, 3143, 2908, 2658, 2398, 2132, 1864, 1599, 1343, 1098, 869, 661, 476, 318, 190, 94, 30, 2, 8, 49, 125, 233, 372, 540, 734, 950, 1185, 1434, 1694, 1961, 2228, 2493, 2750, 2995, 3224, 3432, 3617, 3775, 3904, 4001, 4064, 4093, 4087, 4046, 3971, 3863, 3724, 3556, 3363, 3147, 2912, 2662, 2402, 2136, 1868, 1604, 1347, 1102, 873, 664, 479, 320, 192, 95, 31, 2, 8, 49, 124, 231, 370, 538, 731, 947, 1182, 1432, 1692, 1958, 2226, 2491, 2748, 2993, 3222, 3431, 3616, 3774, 3903, 4000, 4064, 4093, 4087, 4046, 3971, 3864, 3725, 3557, 3363, 3147, 2913, 2663, 2403, 2136, 1869, 1604, 1347, 1102, 873, 664, 479, 320, 192, 95, 31, 2, 8, 49, 124, 232, 371, 539, 732, 949, 1184, 1433, 1694, 1960, 2228, 2492, 2750, 2995, 3224, 3432, 3617, 3776, 3904, 4001, 4064, 4093, 4087, 4046, 3970, 3862, 3723, 3555, 3361, 3145, 2909, 2660, 2399, 2133, 1865, 1600, 1343, 1098, 869, 661, 476, 318, 190, 93, 30, 2, 8, 50, 126, 234, 374, 542, 736, 953, 1188, 1439, 1699, 1966, 2234, 2498, 2755, 3000, 3229, 3437, 3621, 3779, 3907, 4003, 4065, 4093, 4086, 4044, 3968, 3859, 3719, 3550, 3355, 3138, 2903, 2652, 2392, 2125, 1857, 1592, 1336, 1091, 863, 655, 470, 313, 186, 91, 29, 1, 9, 52, 129, 238, 379, 549, 744, 961, 1197, 1448, 1709, 1975, 2243, 2508, 2765, 3009, 3237, 3445, 3628, 3785, 3911, 4006, 4067, 4094, 4085, 4042, 3964, 3854, 3712, 3542, 3346, 3128, 2892, 2641, 2380, 2113, 1845, 1581, 1324, 1080, 853, 646, 463, 307, 181, 87, 27, 1, 10, 55, 133, 245, 387, 558, 754, 973, 1210, 1461, 1722, 1989, 2257, 2522, 2778, 3022, 3249, 3455, 3637, 3792, 3917, 4010, 4070, 4094, 4084, 4038, 3959, 3846, 3703, 3531, 3334, 3115, 2878, 2626, 2364, 2097, 1829, 1565, 1309, 1066, 839, 633, 452, 298, 174, 82, 24, 0, 12, 59, 140, 253, 397, 570, 768, 988, 1226, 1478, 1740, 2008, 2275, 2540, 2795, 3038, 3264, 3469, 3649, 3802, 3925, 4016, 4073, 4095, 4082, 4034, 3952, 3837, 3692, 3518, 3319, 3098, 2859, 2607, 2344, 2077, 1809, 1545, 1290, 1048, 823, 619, 439, 287, 166, 76, 21, 0, 15, 64, 147, 264, 410, 585, 785, 1007, 1246, 1499, 1762, 2030, 2298, 2561, 2816, 3058, 3282, 3485, 3663, 3814, 3934, 4022, 4076, 4095, 4079, 4028, 3943, 3825, 3677, 3501, 3300, 3078, 2837, 2583, 2320, 2053, 1785, 1522, 1267, 1026, 803, 601, 424, 275, 156, 70, 17, 0, 18, 70, 157, 276, 426, 603, 805, 1029, 1270, 1525, 1788, 2056, 2324, 2587, 2841, 3081, 3303, 3504, 3680, 3827, 3944, 4029, 4079, 4095, 4075, 4021, 3932, 3812, 3660, 3482, 3278, 3053, 2811, 2556, 2292, 2024, 1757, 1494, 1241, 1002, 780, 581, 406, 260, 145, 62, 14, 0, 22, 78, 169, 291, 444, 625, 829, 1055, 1298, 1554, 1818, 2086, 2354, 2616, 2869, 3107, 3327, 3525, 3698, 3842, 3956, 4037, 4083, 4094, 4071, 4012, 3920, 3795, 3641, 3459, 3252, 3025, 2781, 2525, 2260, 1992, 1725, 1463, 1211, 974, 755, 558, 387, 244, 133, 54, 10, 1, 27, 88, 182, 309, 465, 649, 857, 1085, 1330, 1587, 1852, 2121, 2388, 2649, 2900, 3137, 3354, 3549, 3719, 3859, 3968, 4045, 4087, 4093, 4065, 4002, 3905, 3776, 3618, 3432, 3223, 2993, 2747, 2489, 2224, 1955, 1688, 1428, 1177, 942, 726, 533, 365, 227, 120, 46, 7, 3, 33, 99, 198, 329, 490, 677, 888, 1119, 1366, 1625, 1891, 2159, 2426, 2686, 2936, 3169, 3384, 3576, 3741, 3877, 3982, 4053, 4090, 4091, 4058, 3990, 3888, 3755, 3592, 3402, 3190, 2957, 2709, 2450, 2184, 1915, 1648, 1389, 1141, 908, 695, 505, 342, 209, 106, 38, 4, 5, 41, 112, 217, 352, 517, 709, 923, 1157, 1406, 1667, 1933, 2202, 2468, 2727, 2974, 3205, 3416, 3604, 3765, 3896, 3996, 4061, 4092, 4088, 4049, 3975, 3868, 3730, 3562, 3369, 3153, 2917, 2667, 2406, 2139, 1870, 1604, 1346, 1100, 871, 661, 476, 318, 189, 92, 30, 2, 9, 51, 128, 238, 379, 549, 744, 962, 1199, 1451, 1712, 1980, 2249, 2514, 2771, 3016, 3244, 3451, 3634, 3790, 3916, 4010, 4069, 4094, 4084, 4038, 3958, 3846, 3702, 3530, 3332, 3112, 2873, 2621, 2358, 2090, 1822, 1557, 1301, 1057, 831, 626, 445, 292, 169, 78, 22, 0, 14, 63, 146, 262, 408, 583, 784, 1006, 1245, 1499, 1763, 2031, 2299, 2563, 2819, 3061, 3285, 3488, 3666, 3817, 3937, 4024, 4077, 4095, 4078, 4026, 3939, 3820, 3671, 3493, 3290, 3066, 2825, 2570, 2306, 2037, 1769, 1505, 1251, 1011, 788, 588, 412, 265, 148, 64, 15, 0, 21, 77, 167, 289, 442, 622, 827, 1053, 1296, 1552, 1817, 2086, 2354, 2617, 2869, 3108, 3329, 3527, 3700, 3844, 3957, 4038, 4084, 4094, 4070, 4010, 3917, 3791, 3636, 3452, 3245, 3017, 2772, 2515, 2249, 1980, 1713, 1451, 1199, 962, 744, 548, 378, 237, 127, 51, 9, 2, 30, 93, 190, 319, 478, 664, 874, 1105, 1351, 1610, 1876, 2145, 2412, 2673, 2923, 3159, 3375, 3568, 3734, 3872, 3978, 4051, 4089, 4092, 4059, 3992, 3892, 3759, 3597, 3408, 3195, 2963, 2715, 2455, 2188, 1919, 1652, 1392, 1143, 910, 697, 507, 343, 209, 107, 38, 4, 5, 42, 113, 217, 354, 519, 711, 926, 1161, 1411, 1671, 1939, 2208, 2474, 2733, 2980, 3211, 3422, 3609, 3770, 3900, 3998, 4063, 4093, 4087, 4047, 3971, 3863, 3723, 3554, 3359, 3141, 2904, 2653, 2391, 2123, 1854, 1589, 1331, 1085, 856, 648, 464, 308, 181, 87, 26, 1, 11, 56, 136, 248, 392, 564, 763, 983, 1222, 1475, 1737, 2006, 2275, 2540, 2796, 3040, 3266, 3472, 3652, 3805, 3928, 4018, 4074, 4095, 4080, 4031, 3947, 3830, 3682, 3506, 3305, 3082, 2841, 2587, 2323, 2054, 1785, 1521, 1266, 1024, 800, 598, 421, 272, 153, 68, 16, 0, 19, 74, 162, 283, 435, 614, 818, 1044, 1287, 1543, 1808, 2077, 2345, 2609, 2862, 3102, 3323, 3522, 3696, 3841, 3955, 4036, 4083, 4094, 4070, 4011, 3918, 3793, 3637, 3454, 3247, 3019, 2773, 2516, 2250, 1981, 1713, 1450, 1199, 961, 743, 547, 377, 236, 126, 50, 8, 2, 31, 95, 192, 322, 482, 669, 879, 1110, 1357, 1616, 1883, 2152, 2420, 2681, 2931, 3166, 3382, 3574, 3740, 3877, 3982, 4053, 4090, 4091, 4057, 3988, 3886, 3752, 3588, 3397, 3184, 2950, 2701, 2440, 2173, 1904, 1637, 1377, 1128, 896, 684, 495, 333, 201, 101, 34, 3, 7, 46, 120, 227, 366, 534, 728, 945, 1181, 1432, 1694, 1962, 2232, 2498, 2756, 3002, 3232, 3441, 3626, 3784, 3911, 4006, 4068, 4094, 4085, 4040, 3961, 3849, 3706, 3533, 3335, 3115, 2876, 2623, 2360, 2092, 1822, 1557, 1300, 1056, 829, 624, 443, 290, 167, 77, 21, 0, 15, 65, 149, 266, 414, 591, 793, 1016, 1257, 1512, 1777, 2046, 2315, 2579, 2834, 3076, 3300, 3502, 3678, 3827, 3945, 4029, 4080, 4095, 4075, 4019, 3929, 3807, 3654, 3474, 3268, 3042, 2798, 2541, 2275, 2006, 1737, 1474, 1221, 982, 761, 563, 391, 247, 134, 55, 10, 1, 27, 88, 183, 311, 468, 653, 863, 1092, 1339, 1597, 1864, 2133, 2401, 2663, 2915, 3151, 3368, 3562, 3730, 3869, 3976, 4050, 4089, 4092, 4060, 3993, 3893, 3760, 3598, 3408, 3195, 2963, 2714, 2454, 2186, 1917, 1649, 1389, 1139, 906, 693, 502, 339, 206, 104, 36, 3, 6, 44, 117, 223, 361, 528, 722, 938, 1174, 1425, 1687, 1955, 2225, 2491, 2750, 2997, 3227, 3437, 3623, 3781, 3909, 4005, 4067, 4094, 4085, 4041, 3962, 3850, 3707, 3535, 3337, 3117, 2878, 2625, 2361, 2093, 1823, 1557, 1300, 1056, 829, 623, 442, 289, 166, 76, 21, 0, 15, 65, 150, 268, 416, 593, 796, 1019, 1261, 1517, 1781, 2051, 2320, 2584, 2840, 3081, 3305, 3506, 3682, 3830, 3947, 4031, 4081, 4095, 4073, 4017, 3926, 3802, 3648, 3467, 3260, 3033, 2788, 2530, 2265, 1995, 1726, 1463, 1210, 971, 752, 554, 383, 241, 130, 52, 9, 1, 29, 93, 190, 319, 478, 665, 876, 1107, 1354, 1614, 1881, 2151, 2419, 2680, 2931, 3166, 3382, 3575, 3741, 3878, 3983, 4054, 4090, 4091, 4056, 3987, 3883, 3748, 3583, 3392, 3177, 2942, 2692, 2431, 2163, 1893, 1626, 1366, 1118, 886, 674, 486, 325, 195, 96, 32, 2, 8, 49, 126, 235, 376, 547, 743, 962, 1200, 1453, 1716, 1984, 2254, 2520, 2778, 3024, 3252, 3460, 3642, 3797, 3922, 4014, 4072, 4095, 4082, 4033, 3950, 3834, 3687, 3512, 3311, 3087, 2846, 2591, 2327, 2057, 1788, 1523, 1267, 1024, 800, 597, 419, 270, 152, 66, 16, 0, 20, 76, 165, 288, 441, 622, 828, 1055, 1299, 1556, 1822, 2092, 2361, 2625, 2878, 3118, 3338, 3536, 3708, 3851, 3963, 4042, 4085, 4094, 4066, 4004, 3907, 3778, 3619, 3433, 3223, 2992, 2744, 2485, 2217, 1947, 1679, 1417, 1166, 930, 714, 521, 355, 218, 113, 41, 5, 4, 39, 108, 212, 347, 512, 704, 919, 1154, 1404, 1666, 1934, 2204, 2472, 2732, 2980, 3212, 3423, 3611, 3772, 3902, 4000, 4064, 4093, 4087, 4044, 3968, 3857, 3715, 3544, 3347, 3128, 2889, 2636, 2373, 2104, 1834, 1567, 1309, 1064, 836, 629, 447, 293, 169, 78, 22, 0, 14, 64, 148, 266, 414, 591, 793, 1017, 1259, 1515, 1780, 2050, 2320, 2585, 2840, 3082, 3306, 3507, 3684, 3832, 3948, 4032, 4081, 4095, 4073, 4015, 3924, 3799, 3644, 3462, 3254, 3026, 2780, 2522, 2256, 1985, 1716, 1453, 1200, 962, 743, 546, 376, 235, 125, 49, 8, 2, 32, 97, 196, 328, 489, 678, 890, 1123, 1371, 1632, 1900, 2170, 2438, 2700, 2950, 3184, 3399, 3590, 3754, 3888, 3990, 4058, 4092, 4089, 4051, 3978, 3872, 3733, 3565, 3371, 3154, 2917, 2665, 2403, 2134, 1863, 1596, 1337, 1090, 860, 651, 465, 308, 181, 86, 26, 1, 11, 57, 138, 252, 398, 572, 772, 994, 1235, 1490, 1754, 2024, 2294, 2560, 2816, 3060, 3286, 3490, 3669, 3819, 3939, 4026, 4078, 4095, 4076, 4022, 3933, 3811, 3659, 3478, 3273, 3046, 2801, 2544, 2278, 2008, 1738, 1474, 1220, 980, 759, 561, 388, 244, 132, 54, 10, 1, 29, 91, 188, 317, 477, 664, 875, 1106, 1354, 1614, 1882, 2152, 2421, 2683, 2934, 3170, 3386, 3578, 3744, 3880, 3985, 4055, 4091, 4090, 4054, 3983, 3879, 3742, 3576, 3383, 3166, 2930, 2679, 2417, 2148, 1877, 1610, 1350, 1102, 871, 660, 474, 315, 186, 90, 28, 1, 10, 55, 134, 247, 391, 564, 764, 985, 1225, 1480, 1744, 2014, 2284, 2550, 2808, 3052, 3278, 3483, 3663, 3815, 3936, 4024, 4077, 4095, 4077, 4024, 3936, 3815, 3663, 3483, 3278, 3052, 2807, 2550, 2284, 2014, 1744, 1479, 1225, 985, 763, 564, 391, 247, 134, 55, 10, 1, 28, 90, 187, 315, 475, 661, 872, 1104, 1352, 1612, 1880, 2150, 2419, 2681, 2933, 3169, 3385, 3578, 3744, 3880, 3985, 4055, 4091, 4090, 4054, 3983, 3878, 3741, 3575, 3382, 3165, 2929, 2677, 2415, 2146, 1875, 1608, 1348, 1100, 869, 658, 472, 313, 185, 89, 27, 1, 11, 56, 136, 249, 394, 568, 768, 990, 1230, 1485, 1750, 2020, 2290, 2556, 2814, 3058, 3284, 3488, 3668, 3819, 3939, 4026, 4078, 4095, 4076, 4022, 3933, 3811, 3658, 3477, 3271, 3043, 2799, 2541, 2274, 2003, 1734, 1469, 1215, 976, 755, 556, 384, 241, 130, 52, 9, 2, 30, 94, 192, 322, 483, 671, 883, 1116, 1364, 1625, 1893, 2164, 2433, 2695, 2946, 3181, 3396, 3588, 3752, 3887, 3990, 4058, 4092, 4089, 4051, 3978, 3871, 3732, 3564, 3369, 3151, 2913, 2661, 2397, 2128, 1857, 1590, 1330, 1083, 853, 644, 460, 303, 177, 83, 24, 0, 13, 61, 143, 259, 406, 583, 784, 1008, 1250, 1506, 1772, 2042, 2312, 2578, 2835, 3077, 3302, 3505, 3682, 3830, 3948, 4032, 4081, 4095, 4073, 4015, 3923, 3798, 3642, 3459, 3250, 3021, 2775, 2516, 2248, 1977, 1708, 1444, 1191, 953, 734, 538, 368, 228, 120, 46, 6, 3, 35, 103, 204, 338, 502, 693, 907, 1142, 1393, 1655, 1923, 2194, 2463, 2724, 2973, 3207, 3419, 3608, 3769, 3901, 3999, 4064, 4093, 4087, 4044, 3967, 3856, 3713, 3541, 3343, 3122, 2883, 2628, 2364, 2094, 1823, 1556, 1298, 1053, 825, 619, 437, 284, 162, 73, 19, 0, 17, 70, 157, 277, 429, 609, 814, 1041, 1285, 1543, 1809, 2080, 2350, 2615, 2870, 3111, 3333, 3532, 3705, 3849, 3962, 4041, 4085, 4094, 4066, 4003, 3906, 3776, 3616, 3429, 3217, 2984, 2736, 2475, 2206, 1935, 1666, 1403, 1152, 917, 701, 509, 344, 209, 106, 37, 3, 6, 44, 117, 224, 363, 532, 727, 945, 1183, 1436, 1700, 1969, 2241, 2508, 2768, 3015, 3245, 3454, 3638, 3795, 3920, 4013, 4072, 4095, 4082, 4033, 3949, 3832, 3684, 3507, 3304, 3080, 2837, 2580, 2314, 2044, 1773, 1507, 1251, 1009, 784, 582, 406, 259, 143, 60, 12, 0, 24, 84, 178, 305, 462, 647, 857, 1088, 1335, 1595, 1863, 2134, 2404, 2667, 2920, 3157, 3375, 3569, 3737, 3875, 3981, 4053, 4090, 4091, 4056, 3986, 3882, 3745, 3579, 3386, 3169, 2933, 2681, 2418, 2148, 1877, 1609, 1348, 1100, 868, 657, 471, 312, 183, 88, 27, 1, 11, 57, 138, 253, 399, 574, 775, 998, 1240, 1495, 1761, 2032, 2303, 2569, 2826, 3070, 3296, 3499, 3677, 3827, 3945, 4030, 4080, 4095, 4073, 4016, 3924, 3800, 3644, 3461, 3252, 3023, 2776, 2516, 2249, 1977, 1707, 1443, 1190, 951, 732, 536, 367, 227, 119, 45, 6, 3, 36, 104, 207, 342, 507, 698, 914, 1150, 1401, 1664, 1933, 2204, 2473, 2734, 2984, 3216, 3428, 3616, 3777, 3906, 4004, 4066, 4094, 4085, 4041, 3961, 3848, 3703, 3529, 3329, 3107, 2866, 2610, 2345, 2074, 1803, 1536, 1278, 1034, 807, 603, 424, 273, 153, 67, 16, 0, 20, 76, 167, 291, 446, 628, 836, 1065, 1312, 1571, 1839, 2110, 2380, 2645, 2899, 3138, 3357, 3554, 3724, 3865, 3974, 4049, 4088, 4092, 4060, 3992, 3891, 3756, 3592, 3401, 3185, 2950, 2699, 2436, 2167, 1895, 1626, 1365, 1115, 882, 670, 481, 321, 190, 92, 29, 1, 10, 54, 133, 246, 390, 564, 764, 986, 1227, 1483, 1748, 2019, 2290, 2557, 2815, 3060, 3287, 3491, 3671, 3822, 3941, 4028, 4079, 4095, 4075, 4019, 3928, 3804, 3649, 3466, 3258, 3029, 2783, 2523, 2255, 1984, 1713, 1449, 1195, 956, 736, 540, 369, 229, 120, 46, 6, 3, 36, 104, 206, 340, 505, 697, 913, 1148, 1400, 1663, 1932, 2204, 2473, 2735, 2984, 3217, 3429, 3617, 3777, 3907, 4004, 4067, 4094, 4085, 4040, 3960, 3846, 3701, 3527, 3326, 3103, 2861, 2605, 2339, 2069, 1797, 1530, 1272, 1028, 802, 598, 419, 269, 150, 65, 15, 0, 22, 79, 171, 296, 452, 636, 844, 1074, 1322, 1582, 1850, 2122, 2392, 2656, 2910, 3148, 3367, 3563, 3732, 3871, 3978, 4052, 4090, 4091, 4057, 3988, 3884, 3748, 3582, 3388, 3172, 2935, 2683, 2419, 2149, 1878, 1609, 1348, 1099, 867, 656, 469, 310, 182, 87, 26, 1, 12, 59, 140, 256, 403, 579, 781, 1006, 1248, 1505, 1771, 2043, 2314, 2581, 2838, 3081, 3306, 3509, 3686, 3834, 3951, 4034, 4082, 4095, 4071, 4011, 3917, 3790, 3632, 3446, 3235, 3004, 2756, 2495, 2226, 1954, 1684, 1420, 1167, 930, 713, 519, 352, 215, 110, 39, 4, 5, 42, 114, 221, 359, 528, 723, 942, 1180, 1433, 1697, 1968, 2240, 2508, 2768, 3016, 3247, 3456, 3641, 3797, 3923, 4015, 4073, 4095, 4081, 4031, 3946, 3827, 3677, 3499, 3294, 3068, 2824, 2566, 2299, 2027, 1756, 1490, 1234, 992, 768, 568, 393, 248, 134, 55, 10, 1, 29, 92, 189, 320, 481, 669, 882, 1116, 1366, 1628, 1897, 2169, 2439, 2702, 2953, 3189, 3404, 3595, 3759, 3893, 3994, 4061, 4093, 4088, 4047, 3971, 3861, 3718, 3547, 3349, 3128, 2887, 2632, 2367, 2096, 1824, 1556, 1297, 1051, 823, 616, 434, 282, 160, 71, 18, 0, 18, 73, 162, 284, 438, 620, 827, 1056, 1303, 1562, 1830, 2102, 2373, 2638, 2893, 3133, 3354, 3551, 3722, 3864, 3973, 4048, 4088, 4092, 4060, 3992, 3890, 3756, 3591, 3399, 3183, 2946, 2695, 2431, 2161, 1889, 1620, 1358, 1108, 875, 663, 475, 315, 186, 89, 27, 1, 11, 57, 138, 253, 400, 575, 777, 1001, 1244, 1501, 1768, 2039, 2311, 2578, 2835, 3079, 3305, 3508, 3685, 3834, 3951, 4034, 4082, 4095, 4071, 4011, 3916, 3789, 3630, 3444, 3233, 3001, 2752, 2491, 2222, 1950, 1679, 1415, 1162, 925, 708, 514, 348, 211, 107, 38, 4, 6, 44, 117, 225, 365, 535, 731, 951, 1190, 1444, 1709, 1980, 2252, 2521, 2781, 3028, 3258, 3466, 3650, 3805, 3929, 4019, 4075, 4095, 4079, 4026, 3939, 3818, 3666, 3486, 3280, 3052, 2806, 2547, 2279, 2007, 1735, 1470, 1214, 973, 751, 552, 380, 237, 126, 49, 8, 2, 33, 99, 200, 334, 498, 689, 904, 1140, 1391, 1655, 1925, 2197, 2467, 2729, 2980, 3213, 3426, 3615, 3776, 3906, 4004, 4067, 4094, 4085, 4040, 3959, 3845, 3699, 3523, 3322, 3098, 2855, 2598, 2332, 2060, 1788, 1521, 1263, 1019, 793, 589, 411, 262, 145, 61, 13, 0, 24, 84, 178, 306, 464, 651, 862, 1094, 1343, 1604, 1874, 2146, 2417, 2681, 2934, 3171, 3389, 3582, 3749, 3885, 3989, 4058, 4092, 4089, 4051, 3976, 3868, 3728, 3557, 3360, 3140, 2900, 2646, 2380, 2109, 1837, 1568, 1308, 1061, 832, 624, 441, 286, 163, 74, 19, 0, 17, 71, 159, 281, 434, 616, 823, 1052, 1299, 1558, 1827, 2099, 2371, 2636, 2891, 3132, 3353, 3551, 3722, 3864, 3973, 4049, 4088, 4092, 4060, 3991, 3889, 3753, 3588, 3395, 3178, 2942, 2689, 2425, 2154, 1882, 1612, 1350, 1101, 868, 656, 469, 310, 181, 86, 25, 1, 12, 60, 143, 259, 408, 585, 789, 1014, 1258, 1516, 1784, 2056, 2328, 2595, 2852, 3095, 3320, 3521, 3697, 3844, 3958, 4039, 4085, 4094, 4067, 4004, 3907, 3776, 3615, 3426, 3213, 2979, 2728, 2466, 2196, 1923, 1652, 1389, 1137, 902, 686, 495, 331, 198, 98, 32, 2, 8, 51, 128, 240, 384, 558, 758, 980, 1222, 1478, 1745, 2017, 2289, 2557, 2816, 3061, 3289, 3494, 3674, 3825, 3944, 4030, 4080, 4095, 4073, 4015, 3922, 3796, 3639, 3454, 3244, 3012, 2764, 2502, 2233, 1960, 1689, 1424, 1171, 932, 714, 519, 352, 214, 109, 39, 4, 5, 43, 116, 224, 363, 533, 730, 950, 1189, 1444, 1710, 1981, 2254, 2523, 2783, 3031, 3261, 3469, 3653, 3807, 3931, 4021, 4076, 4095, 4078, 4024, 3936, 3814, 3660, 3478, 3271, 3042, 2795, 2535, 2266, 1994, 1722, 1456, 1201, 960, 739, 541, 370, 229, 120, 45, 6, 3, 37, 106, 209, 345, 512, 706, 923, 1161, 1414, 1679, 1950, 2223, 2492, 2754, 3003, 3236, 3447, 3633, 3791, 3919, 4013, 4072, 4095, 4081, 4032, 3947, 3829, 3679, 3500, 3295, 3068, 2823, 2564, 2296, 2023, 1751, 1484, 1227, 985, 762, 561, 387, 242, 130, 52, 9, 2, 31, 97, 197, 330, 494, 685, 900, 1136, 1388, 1652, 1922, 2195, 2466, 2728, 2979, 3214, 3427, 3616, 3777, 3908, 4005, 4067, 4094, 4084, 4038, 3957, 3842, 3694, 3518, 3315, 3090, 2846, 2588, 2321, 2048, 1776, 1508, 1250, 1007, 781, 578, 402, 254, 139, 57, 11, 1, 27, 90, 187, 317, 478, 667, 880, 1115, 1365, 1628, 1899, 2172, 2443, 2706, 2959, 3194, 3410, 3601, 3765, 3898, 3998, 4064, 4093, 4086, 4043, 3965, 3852, 3707, 3533, 3332, 3109, 2866, 2609, 2342, 2070, 1797, 1529, 1270, 1025, 798, 593, 414, 265, 146, 62, 13, 0, 24, 84, 178, 306, 465, 652, 864, 1097, 1347, 1609, 1879, 2152, 2424, 2688, 2941, 3178, 3396, 3589, 3754, 3890, 3992, 4060, 4092, 4088, 4047, 3971, 3861, 3718, 3546, 3346, 3124, 2883, 2626, 2360, 2088, 1815, 1546, 1286, 1040, 812, 605, 425, 273, 153, 66, 15, 0, 22, 79, 172, 298, 455, 640, 851, 1083, 1332, 1594, 1864, 2137, 2408, 2673, 2927, 3166, 3384, 3579, 3746, 3883, 3988, 4057, 4092, 4089, 4050, 3976, 3867, 3726, 3555, 3357, 3136, 2895, 2640, 2373, 2101, 1828, 1559, 1299, 1052, 822, 615, 433, 279, 158, 70, 17, 0, 20, 76, 167, 291, 447, 632, 841, 1072, 1321, 1582, 1852, 2125, 2397, 2662, 2917, 3156, 3376, 3571, 3740, 3878, 3984, 4055, 4091, 4090, 4053, 3980, 3872, 3732, 3562, 3365, 3145, 2905, 2649, 2383, 2111, 1838, 1569, 1308, 1060, 830, 621, 438, 284, 161, 72, 18, 0, 19, 73, 163, 287, 442, 626, 835, 1065, 1313, 1574, 1844, 2117, 2389, 2655, 2910, 3150, 3370, 3566, 3736, 3875, 3982, 4054, 4090, 4090, 4054, 3982, 3875, 3736, 3566, 3370, 3150, 2910, 2655, 2389, 2117, 1844, 1574, 1313, 1065, 834, 625, 442, 287, 163, 73, 19, 0, 18, 72, 162, 285, 439, 623, 831, 1061, 1309, 1571, 1840, 2113, 2386, 2652, 2907, 3147, 3367, 3564, 3734, 3874, 3981, 4053, 4090, 4091, 4055, 3983, 3876, 3737, 3568, 3372, 3152, 2912, 2657, 2391, 2119, 1845, 1576, 1314, 1066, 835, 626, 442, 287, 164, 73, 19, 0, 18, 72, 161, 284, 439, 622, 831, 1061, 1309, 1570, 1840, 2114, 2386, 2652, 2907, 3147, 3368, 3565, 3734, 3874, 3981, 4054, 4090, 4091, 4054, 3982, 3876, 3736, 3567, 3370, 3150, 2910, 2655, 2389, 2117, 1843, 1574, 1312, 1064, 833, 624, 441, 286, 162, 73, 18, 0, 18, 73, 163, 286, 441, 625, 834, 1065, 1313, 1574, 1844, 2118, 2390, 2656, 2911, 3151, 3371, 3568, 3737, 3876, 3983, 4055, 4091, 4090, 4053, 3981, 3873, 3733, 3563, 3366, 3145, 2905, 2650, 2383, 2111, 1837, 1568, 1306, 1058, 828, 620, 437, 283, 160, 71, 17, 0, 19, 75, 166, 290, 446, 630, 840, 1071, 1320, 1582, 1852, 2126, 2398, 2664, 2919, 3158, 3378, 3573, 3742, 3880, 3986, 4056, 4091, 4090, 4051, 3977, 3869, 3728, 3557, 3359, 3137, 2896, 2640, 2373, 2101, 1827, 1558, 1297, 1049, 820, 612, 430, 277, 156, 68, 16, 0, 21, 78, 170, 296, 453, 638, 849, 1082, 1331, 1593, 1864, 2138, 2410, 2675, 2930, 3168, 3387, 3582, 3749, 3886, 3990, 4059, 4092, 4089, 4049, 3973, 3863, 3720, 3548, 3349, 3126, 2884, 2627, 2360, 2087, 1813, 1544, 1284, 1037, 808, 602, 421, 270, 150, 64, 14, 0, 23, 82, 176, 304, 462, 650, 862, 1095, 1346, 1609, 1880, 2153, 2425, 2691, 2944, 3182, 3399, 3592, 3758, 3893, 3995, 4062, 4093, 4087, 4045, 3967, 3855, 3710, 3536, 3335, 3111, 2868, 2610, 2342, 2069, 1796, 1527, 1267, 1021, 794, 589, 410, 261, 143, 60, 12, 1, 26, 87, 184, 314, 475, 664, 878, 1113, 1364, 1628, 1899, 2173, 2445, 2709, 2962, 3199, 3414, 3606, 3769, 3902, 4001, 4065, 4094, 4085, 4040, 3960, 3845, 3698, 3521, 3318, 3093, 2848, 2589, 2321, 2048, 1774, 1506, 1247, 1002, 777, 574, 397, 250, 135, 55, 10, 1, 30, 94, 194, 326, 490, 681, 897, 1133, 1386, 1651, 1923, 2197, 2468, 2732, 2984, 3218, 3432, 3621, 3782, 3912, 4008, 4069, 4094, 4083, 4035, 3951, 3833, 3683, 3504, 3299, 3071, 2825, 2565, 2296, 2022, 1749, 1481, 1223, 980, 756, 556, 382, 238, 126, 49, 7, 3, 34, 102, 205, 341, 507, 701, 920, 1158, 1412, 1678, 1950, 2224, 2495, 2758, 3008, 3241, 3453, 3639, 3797, 3923, 4016, 4074, 4095, 4079, 4027, 3940, 3819, 3665, 3483, 3275, 3045, 2798, 2536, 2266, 1992, 1719, 1452, 1196, 955, 733, 535, 364, 224, 116, 42, 5, 4, 40, 112, 219, 358, 528, 725, 946, 1186, 1442, 1709, 1982, 2256, 2526, 2788, 3036, 3267, 3476, 3659, 3813, 3936, 4025, 4078, 4095, 4075, 4019, 3927, 3802, 3645, 3459, 3249, 3016, 2766, 2504, 2233, 1959, 1686, 1420, 1165, 926, 707, 512, 345, 208, 105, 36, 3, 7, 47, 124, 235, 378, 552, 752, 975, 1218, 1476, 1744, 2017, 2291, 2561, 2821, 3068, 3296, 3502, 3681, 3832, 3950, 4034, 4082, 4094, 4070, 4009, 3912, 3783, 3622, 3432, 3218, 2983, 2731, 2467, 2196, 1921, 1649, 1384, 1131, 895, 679, 487, 324, 192, 93, 29, 1, 10, 56, 137, 253, 401, 578, 782, 1009, 1254, 1514, 1783, 2057, 2330, 2599, 2858, 3102, 3327, 3529, 3705, 3851, 3964, 4043, 4087, 4093, 4063, 3997, 3895, 3761, 3595, 3402, 3185, 2947, 2693, 2427, 2154, 1880, 1609, 1345, 1094, 860, 648, 461, 302, 174, 81, 22, 0, 15, 66, 153, 274, 427, 609, 816, 1046, 1294, 1556, 1826, 2100, 2373, 2641, 2898, 3139, 3361, 3559, 3730, 3871, 3979, 4053, 4090, 4091, 4055, 3982, 3875, 3736, 3566, 3368, 3147, 2906, 2650, 2382, 2109, 1835, 1564, 1303, 1054, 823, 615, 432, 278, 156, 68, 16, 0, 21, 78, 171, 298, 456, 642, 854, 1087, 1338, 1601, 1873, 2147, 2420, 2686, 2941, 3179, 3397, 3591, 3757, 3893, 3995, 4062, 4093, 4087, 4044, 3966, 3853, 3708, 3532, 3330, 3105, 2861, 2603, 2334, 2060, 1786, 1517, 1257, 1011, 784, 580, 402, 254, 138, 56, 10, 1, 29, 93, 192, 324, 488, 680, 896, 1133, 1386, 1651, 1924, 2198, 2470, 2735, 2987, 3222, 3436, 3625, 3785, 3914, 4010, 4071, 4095, 4082, 4032, 3947, 3828, 3676, 3496, 3289, 3060, 2813, 2551, 2281, 2007, 1733, 1465, 1208, 965, 742, 543, 371, 228, 119, 44, 6, 4, 39, 110, 216, 354, 524, 721, 941, 1182, 1438, 1705, 1979, 2253, 2524, 2786, 3035, 3267, 3476, 3659, 3814, 3937, 4025, 4078, 4095, 4075, 4018, 3925, 3799, 3642, 3455, 3243, 3010, 2760, 2496, 2225, 1950, 1677, 1411, 1156, 917, 699, 504, 338, 203, 100, 33, 2, 8, 51, 129, 242, 388, 564, 766, 991, 1236, 1495, 1764, 2038, 2312, 2582, 2841, 3087, 3314, 3518, 3695, 3843, 3959, 4040, 4085, 4094, 4065, 4001, 3901, 3767, 3603, 3411, 3194, 2956, 2702, 2437, 2164, 1889, 1617, 1353, 1101, 866, 653, 465, 305, 177, 82, 23, 0, 14, 65, 152, 273, 425, 607, 815, 1045, 1294, 1555, 1826, 2101, 2374, 2642, 2899, 3141, 3363, 3561, 3732, 3873, 3981, 4054, 4090, 4090, 4053, 3980, 3872, 3732, 3560, 3362, 3140, 2898, 2641, 2373, 2099, 1824, 1554, 1292, 1044, 814, 606, 424, 272, 151, 65, 14, 0, 23, 83, 178, 307, 467, 655, 869, 1104, 1356, 1620, 1892, 2167, 2440, 2706, 2960, 3197, 3414, 3606, 3770, 3903, 4002, 4066, 4094, 4085, 4039, 3957, 3840, 3692, 3513, 3309, 3081, 2835, 2575, 2305, 2030, 1756, 1487, 1228, 984, 759, 557, 383, 238, 126, 49, 7, 3, 35, 104, 207, 344, 512, 708, 927, 1167, 1423, 1690, 1963, 2238, 2510, 2773, 3023, 3255, 3466, 3651, 3807, 3932, 4022, 4077, 4095, 4076, 4021, 3930, 3805, 3648, 3462, 3251, 3018, 2768, 2504, 2233, 1957, 1684, 1417, 1162, 922, 703, 508, 341, 205, 102, 34, 2, 8, 50, 128, 241, 387, 562, 765, 990, 1235, 1494, 1763, 2038, 2312, 2582, 2842, 3088, 3315, 3519, 3697, 3845, 3960, 4041, 4086, 4094, 4065, 3999, 3898, 3764, 3599, 3406, 3188, 2950, 2696, 2429, 2156, 1881, 1609, 1345, 1093, 859, 646, 458, 300, 172, 79, 21, 0, 16, 68, 157, 279, 433, 617, 826, 1058, 1307, 1570, 1841, 2116, 2390, 2658, 2914, 3155, 3376, 3573, 3743, 3881, 3987, 4057, 4092, 4089, 4049, 3974, 3863, 3720, 3546, 3345, 3121, 2877, 2619, 2350, 2076, 1801, 1530, 1269, 1022, 794, 588, 409, 259, 141, 58, 11, 1, 28, 91, 190, 322, 485, 677, 893, 1131, 1384, 1650, 1923, 2199, 2471, 2736, 2989, 3224, 3438, 3627, 3788, 3917, 4012, 4072, 4095, 4081, 4030, 3944, 3823, 3670, 3487, 3279, 3049, 2800, 2538, 2266, 1991, 1717, 1449, 1192, 950, 728, 530, 359, 219, 112, 40, 4, 5, 43, 118, 227, 369, 542, 742, 965, 1208, 1467, 1735, 2010, 2285, 2556, 2817, 3065, 3294, 3501, 3681, 3832, 3951, 4035, 4083, 4094, 4069, 4006, 3909, 3777, 3615, 3424, 3208, 2971, 2717, 2451, 2178, 1903, 1630, 1365, 1112, 876, 661, 471, 310, 181, 85, 24, 0, 14, 64, 150, 270, 422, 604, 812, 1043, 1291, 1554, 1825, 2100, 2374, 2643, 2900, 3142, 3365, 3563, 3734, 3875, 3982, 4055, 4091, 4090, 4052, 3978, 3869, 3727, 3554, 3354, 3131, 2888, 2630, 2361, 2086, 1811, 1540, 1278, 1031, 801, 594, 414, 263, 144, 60, 12, 1, 26, 89, 187, 318, 481, 672, 888, 1126, 1379, 1645, 1919, 2194, 2467, 2732, 2985, 3221, 3436, 3625, 3786, 3916, 4011, 4071, 4095, 4081, 4030, 3944, 3823, 3670, 3488, 3279, 3048, 2799, 2537, 2265, 1990, 1716, 1447, 1190, 948, 726, 528, 357, 217, 111, 39, 4, 6, 44, 119, 229, 372, 546, 746, 970, 1214, 1473, 1742, 2017, 2292, 2563, 2824, 3072, 3301, 3507, 3686, 3836, 3954, 4037, 4084, 4094, 4067, 4003, 3904, 3771, 3607, 3415, 3198, 2960, 2706, 2439, 2166, 1890, 1617, 1352, 1100, 865, 651, 462, 303, 174, 80, 22, 0, 16, 68, 156, 278, 433, 617, 826, 1058, 1308, 1571, 1843, 2119, 2393, 2661, 2918, 3159, 3380, 3577, 3746, 3884, 3989, 4059, 4092, 4088, 4047, 3970, 3858, 3714, 3538, 3336, 3111, 2866, 2607, 2337, 2062, 1787, 1516, 1255, 1009, 781, 576, 398, 250, 135, 54, 9, 2, 31, 97, 199, 334, 500, 694, 913, 1152, 1408, 1675, 1949, 2224, 2497, 2761, 3013, 3247, 3459, 3645, 3803, 3929, 4020, 4076, 4095, 4077, 4022, 3931, 3806, 3649, 3463, 3251, 3018, 2766, 2502, 2230, 1954, 1680, 1412, 1157, 917, 698, 503, 336, 201, 99, 32, 2, 9, 53, 133, 248, 396, 573, 778, 1005, 1252, 1513, 1783, 2058, 2334, 2604, 2863, 3109, 3334, 3537, 3712, 3857, 3970, 4047, 4088, 4092, 4059, 3989, 3885, 3746, 3577, 3380, 3159, 2918, 2661, 2393, 2118, 1842, 1570, 1307, 1057, 825, 615, 432, 277, 155, 67, 15, 0, 22, 81, 176, 305, 465, 654, 869, 1105, 1357, 1623, 1896, 2172, 2446, 2712, 2967, 3204, 3421, 3613, 3776, 3908, 4006, 4069, 4094, 4083, 4034, 3950, 3831, 3679, 3498, 3291, 3061, 2812, 2550, 2278, 2003, 1728, 1459, 1200, 957, 734, 535, 363, 222, 114, 41, 4, 5, 43, 117, 227, 369, 542, 742, 966, 1210, 1469, 1739, 2014, 2289, 2561, 2823, 3071, 3300, 3506, 3686, 3837, 3954, 4037, 4084, 4094, 4067, 4002, 3903, 3769, 3605, 3412, 3194, 2955, 2700, 2433, 2159, 1883, 1610, 1345, 1092, 858, 644, 456, 297, 170, 77, 20, 0, 17, 71, 161, 285, 441, 627, 838, 1071, 1322, 1587, 1859, 2135, 2410, 2678, 2934, 3174, 3394, 3589, 3757, 3893, 3995, 4063, 4093, 4086, 4043, 3963, 3848, 3700, 3522, 3318, 3090, 2843, 2582, 2311, 2036, 1760, 1490, 1230, 985, 759, 556, 381, 236, 124, 47, 7, 3, 37, 107, 213, 352, 522, 719, 941, 1183, 1441, 1709, 1984, 2260, 2532, 2796, 3046, 3277, 3486, 3669, 3823, 3944, 4031, 4081, 4095, 4071, 4010, 3914, 3784, 3622, 3431, 3216, 2979, 2725, 2458, 2185, 1908, 1635, 1368, 1115, 878, 662, 472, 310, 180, 84, 24, 0, 14, 65, 152, 273, 427, 610, 820, 1052, 1302, 1565, 1837, 2114, 2389, 2657, 2915, 3157, 3378, 3576, 3745, 3884, 3989, 4059, 4092, 4088, 4047, 3969, 3857, 3711, 3535, 3332, 3106, 2860, 2600, 2329, 2054, 1778, 1507, 1246, 999, 772, 568, 391, 244, 130, 51, 8, 2, 34, 102, 206, 343, 512, 708, 929, 1170, 1427, 1695, 1970, 2247, 2519, 2783, 3034, 3267, 3477, 3661, 3816, 3939, 4027, 4080, 4095, 4073, 4014, 3919, 3790, 3629, 3439, 3225, 2988, 2735, 2469, 2195, 1918, 1644, 1378, 1123, 885, 669, 478, 315, 184, 86, 25, 0, 13, 63, 149, 270, 423, 605, 814, 1046, 1295, 1559, 1831, 2107, 2383, 2652, 2910, 3152, 3374, 3572, 3742, 3882, 3988, 4058, 4092, 4088, 4048, 3971, 3858, 3713, 3537, 3335, 3108, 2863, 2602, 2332, 2056, 1780, 1509, 1248, 1001, 773, 569, 392, 244, 130, 51, 8, 2, 34, 102, 206, 343, 512, 708, 929, 1171, 1428, 1697, 1972, 2248, 2521, 2785, 3036, 3268, 3479, 3663, 3818, 3940, 4028, 4080, 4095, 4072, 4013, 3917, 3788, 3626, 3436, 3221, 2984, 2730, 2464, 2190, 1913, 1639, 1372, 1118, 880, 664, 473, 311, 181, 84, 24, 0, 14, 65, 152, 274, 428, 611, 821, 1053, 1304, 1567, 1840, 2117, 2392, 2661, 2919, 3160, 3382, 3579, 3748, 3886, 3991, 4060, 4092, 4088, 4045, 3967, 3853, 3706, 3529, 3325, 3098, 2851, 2590, 2319, 2043, 1767, 1496, 1235, 989, 763, 559, 383, 238, 125, 48, 7, 3, 37, 107, 213, 352, 522, 721, 943, 1186, 1444, 1713, 1989, 2265, 2538, 2801, 3051, 3283, 3491, 3674, 3827, 3947, 4033, 4082, 4094, 4069, 4007, 3909, 3777, 3614, 3422, 3204, 2966, 2711, 2443, 2169, 1892, 1618, 1352, 1099, 863, 648, 460, 300, 172, 78, 21, 0, 17, 71, 161, 285, 442, 628, 840, 1074, 1326, 1591, 1865, 2141, 2416, 2685, 2941, 3182, 3401, 3596, 3762, 3898, 3999, 4065, 4094, 4085, 4039, 3957, 3840, 3690, 3510, 3303, 3074, 2825, 2563, 2291, 2014, 1739, 1468, 1209, 964, 740, 539, 366, 224, 115, 41, 4, 5, 43, 117, 227, 370, 544, 745, 970, 1214, 1474, 1745, 2021, 2297, 2569, 2832, 3080, 3309, 3515, 3694, 3843, 3960, 4041, 4086, 4093, 4064, 3997, 3894, 3758, 3591, 3395, 3175, 2934, 2677, 2408, 2133, 1856, 1583, 1318, 1066, 833, 622, 436, 281, 157, 68, 16, 0, 22, 81, 176, 305, 467, 657, 872, 1109, 1363, 1630, 1904, 2181, 2456, 2723, 2978, 3215, 3432, 3622, 3785, 3915, 4011, 4072, 4095, 4080, 4029, 3941, 3819, 3664, 3480, 3269, 3036, 2785, 2521, 2247, 1971, 1695, 1426, 1168, 927, 706, 509, 341, 204, 101, 33, 2, 9, 53, 133, 248, 397, 576, 781, 1010, 1258, 1520, 1792, 2069, 2345, 2616, 2876, 3121, 3347, 3548, 3723, 3866, 3977, 4052, 4090, 4091, 4054, 3981, 3872, 3730, 3557, 3357, 3132, 2888, 2628, 2358, 2081, 1805, 1532, 1270, 1021, 791, 584, 404, 254, 137, 55, 10, 1, 31, 97, 199, 334, 502, 697, 917, 1158, 1415, 1684, 1960, 2237, 2510, 2775, 3027, 3261, 3472, 3658, 3814, 3938, 4027, 4079, 4095, 4073, 4014, 3919, 3789, 3628, 3438, 3222, 2985, 2730, 2463, 2189, 1911, 1637, 1370, 1115, 877, 661, 470, 308, 178, 83, 23, 0, 15, 67, 156, 279, 434, 619, 831, 1064, 1316, 1581, 1854, 2132, 2407, 2676, 2934, 3175, 3395, 3591, 3759, 3895, 3997, 4064, 4093, 4086, 4040, 3958, 3842, 3692, 3512, 3305, 3075, 2827, 2564, 2291, 2015, 1738, 1468, 1208, 963, 738, 538, 365, 223, 114, 41, 4, 5, 44, 119, 230, 374, 548, 750, 976, 1222, 1483, 1754, 2030, 2307, 2579, 2841, 3089, 3318, 3523, 3701, 3849, 3964, 4044, 4087, 4093, 4061, 3992, 3888, 3750, 3580, 3383, 3161, 2918, 2660, 2390, 2114, 1837, 1564, 1299, 1049, 816, 606, 423, 269, 149, 63, 13, 1, 26, 88, 186, 319, 483, 676, 894, 1133, 1389, 1657, 1933, 2210, 2484, 2751, 3004, 3240, 3454, 3642, 3801, 3928, 4020, 4076, 4095,3000,2000,1000,0};
#define DAC0(a) *(volatile int16_t *)&(DAC0_DAT0L)=a

#define BUFFER_SIZE 29200                  // up to 85% of dynamic memory (65,536 bytes)
#define SAMPLE_RATE 500000                   // see below maximum values
#define SAMPLE_AVERAGING 0                  // 0, 4, 8, 16 or 32
#define SAMPLING_GAIN 1                     // 1, 2, 4, 8, 16, 32 or 64
#define SAMPLE_RESOLUTION 12                // 8, 10, 12 or 16 



// Main Loop Flow
#define CHECKINPUT_INTERVAL   50000         // 20 times per second
#define DISPLAY_INTERVAL      100000        // 10 times per second
#define SERIAL_PORT_SPEED     9600          // USB is always 12 Mbit/sec on teensy
#define DEBUG                 false

unsigned long lastInAvail;       //
unsigned long lastDisplay;       //
unsigned long lastBlink;         //
unsigned long currentTime;       //
unsigned long func_timer; // <<<<<<<<<<< Time execution of different functions
bool          STREAM  = false;
bool          VERBOSE = true;
bool          BINARY = true;
// I/O-Pins
const int readPin0             = A14;
const int ledPin               = LED_BUILTIN;

//ADC & DMA Config
ADC *adc = new ADC(); //adc object
DMAChannel dma0;
// Variables for ADC0
DMAMEM static uint16_t buf_a[BUFFER_SIZE]; // buffer a
DMAMEM static uint16_t buf_b[BUFFER_SIZE]; // buffer b
volatile uint8_t          aorb_busy  = 0;      //
volatile uint8_t          a_full     = 0;      //
volatile uint8_t          b_full     = 0;      //
uint32_t                    freq     = SAMPLE_RATE;
uint8_t                     aver     = SAMPLE_AVERAGING;
uint8_t                      res     = SAMPLE_RESOLUTION;
uint8_t                    sgain     = SAMPLING_GAIN;
float                       Vmax     = 3.3;
ADC_REFERENCE               Vref     = ADC_REFERENCE::REF_3V3;
ADC_SAMPLING_SPEED    samp_speed     = ADC_SAMPLING_SPEED::VERY_HIGH_SPEED;
ADC_CONVERSION_SPEED  conv_speed     = ADC_CONVERSION_SPEED::VERY_HIGH_SPEED;

// Processing Buffer
uint16_t processed_buf[BUFFER_SIZE]; // processed data buffer

void setup() { // =====================================================

  // Setup chirp
  analogWriteResolution(12);
  SIM_SCGC2 |= SIM_SCGC2_DAC0; // enable DAC clock
  DAC0_C0 = DAC_C0_DACEN | DAC_C0_DACRFS; // enable the DAC module, 3.3V reference

  pinMode(LED_BUILTIN, OUTPUT);
  pinMode(readPin0, INPUT); // single ended

  // Setup monitor pin
  pinMode(ledPin, OUTPUT);
  digitalWriteFast(ledPin, LOW); // LED low, setup start

  while (!Serial && millis() < 3000) ;
  Serial.begin(Serial.baud());
  Serial.println("ADC Server (Minimal)");
  Serial.println("c to start conversion, p to print buffer");
  
  // clear buffers
  memset((void*)buf_a, 0, sizeof(buf_a));
  memset((void*)buf_b, 0, sizeof(buf_b));
  memset((void*)processed_buf, 0, sizeof(buf_b));
  
  // LED on, setup complete
  digitalWriteFast(ledPin, HIGH);

} // setup =========================================================

int          inByte   = 0;
String inNumberString = "";
long         inNumber = -1;
boolean   chunk1_sent = false;
boolean   chunk2_sent = false;
boolean   chunk3_sent = false;


void loop() { // ===================================================

  // Keep track of loop time
  currentTime = micros();
  // Commands:
  // c initiate single conversion
  // p print buffer
  
  if ((currentTime-lastInAvail) >= CHECKINPUT_INTERVAL) {
    lastInAvail = currentTime;
    if (Serial.available()) {
      inByte=Serial.read();
      
      if (inByte == 'c') { // single block conversion
          if ((aorb_busy == 1) || (aorb_busy == 2)) { stop_ADC(); }
          setup_ADC_single();
          start_ADC();
          wait_ADC_single();
          stop_ADC();
          adc->printError();
          adc->resetError();
      } else if (inByte == 's') { // print buffer
          for (int i = 0; i < 7605; i++){
            DAC0(chirp[i]);
            DAC0(chirp[i]);
            DAC0(chirp[i]);
            DAC0(chirp[i]);
            DAC0(chirp[i]);
            DAC0(chirp[i]);
            DAC0(chirp[i]);
            DAC0(chirp[i]);
            DAC0(chirp[i]);
            DAC0(chirp[i]);
            //delayMicroseconds(2.15);
          }
      }else if (inByte == 'p') { // print buffer
          printBuffer(buf_a, 0, BUFFER_SIZE-1);
      }
      if (inByte == 't') { // transmit and sample
          uint32_t   transmit_time = micros();
          for (int i = 0; i < 7605; i++){
            DAC0(chirp[i]);
            DAC0(chirp[i]);
            DAC0(chirp[i]);
            DAC0(chirp[i]);
            DAC0(chirp[i]);
            DAC0(chirp[i]);
            DAC0(chirp[i]);
            DAC0(chirp[i]);
            DAC0(chirp[i]);
            DAC0(chirp[i]);
          }
          if ((aorb_busy == 1) || (aorb_busy == 2)) { stop_ADC(); }
          setup_ADC_single();
          start_ADC();
          //uint32_t   recieve_time = micros();
          wait_ADC_single();
          stop_ADC();
          adc->printError();
          adc->resetError();
          //Serial.printf("%d\n", recieve_time-transmit_time);
      }
    } // end if serial input available
  } // end check serial in time interval
    
  if ((currentTime-lastDisplay) >= DISPLAY_INTERVAL) {
    lastDisplay = currentTime;
    adc->printError();
    adc->resetError();
  } 
    
  

} // end loop ======================================================


// ADC
void setup_ADC_single(void) {
  // clear buffers
  memset((void*)buf_a, 0, sizeof(buf_a));
  // Initialize the ADC
  if (sgain >1) { adc->enablePGA(sgain, ADC_0); }  else { adc->disablePGA(ADC_0); }         
  adc->setReference(Vref, ADC_0);
  adc->setAveraging(aver); 
  adc->setResolution(res); 
  if (((Vref == ADC_REFERENCE::REF_3V3) && (Vmax > 3.29)) || ((Vref == ADC_REFERENCE::REF_1V2) && (Vmax > 1.19))) { 
    adc->disableCompare(ADC_0);
  } else if (Vref == ADC_REFERENCE::REF_3V3) {
    adc->enableCompare(Vmax/3.3*adc->getMaxValue(ADC_0), 0, ADC_0);
  } else if (Vref == ADC_REFERENCE::REF_1V2) {
    adc->enableCompare(Vmax/1.2*adc->getMaxValue(ADC_0), 0, ADC_0);    
  }
  //adc->enableCompareRange(1.0*adc->getMaxValue(ADC_1)/3.3, 2.0*adc->getMaxValue(ADC_1)/3.3, 1, 1, ADC_1); // ready if value lies out of [1.0,2.0] V
  adc->setConversionSpeed(conv_speed, ADC_0);
  adc->setSamplingSpeed(samp_speed, ADC_0);      

  // Initialize dma
  dma0.source((volatile uint16_t&)ADC0_RA);
  dma0.destinationBuffer(buf_a, sizeof(buf_a));
  dma0.triggerAtHardwareEvent(DMAMUX_SOURCE_ADC0);
  dma0.interruptAtCompletion();
  //dma0.disableOnCompletion();
  dma0.attachInterrupt(&dma0_isr_single);
}

void start_ADC(void) {
    // Start adc
    aorb_busy  = 1;
    a_full    = 0;
    b_full    = 0;
    adc->adc0->startSingleRead(readPin0);
    // frequency, hardware trigger and dma
    adc->adc0->startPDB(freq); // set ADC_SC2_ADTRG
    adc->enableDMA(ADC_0); // set ADC_SC2_DMAEN
    dma0.enable();
}

void stop_ADC(void) {
    PDB0_CH0C1 = 0; // diasble ADC0 pre triggers    
    dma0.disable();
    adc->disableDMA(ADC_0);
    adc->adc0->stopPDB();
    aorb_busy = 0;
}

void wait_ADC_single() {
  uint32_t   end_time = micros();
  uint32_t start_time = micros();
  while (!a_full) {
    end_time = micros();
    if ((end_time - start_time) > 1100000) {
      Serial.printf("Timeout %d %d\n", a_full, aorb_busy);
      break;
    }
  }
  //Serial.printf("%d\n", end_time-start_time);
}

void dma0_isr_single(void) {
  aorb_busy = 0;
     a_full = 1;
  dma0.clearInterrupt(); // takes more than 0.5 micro seconds
  dma0.clearComplete(); // takes about ? micro seconds
}


void printBuffer(uint16_t *buffer, size_t start, size_t end) {
  size_t i;
  if (VERBOSE) {
    for (i = start; i <= end; i++) { Serial.println(buffer[i]); }
  } else {
    for (i = start; i <= end; i++) {
      serial16Print(buffer[i]);
      Serial.println(); }
  }
}

void print2Buffer(uint16_t *buffer1,uint16_t *buffer2, size_t start, size_t end) {
  size_t i;
  if (VERBOSE) {
    for (i = start; i <= end; i++) { 
      Serial.print(buffer1[i]); 
      Serial.print(","); 
      Serial.println(buffer2[i]);}
  } else if (BINARY) {
    for (i = start; i <= end; i++) {
      byte* byteData1 = (byte*) buffer1[i];
      byte* byteData2 = (byte*) buffer2[i];
      byte buf[5] = {byteData1[0],byteData1[1],byteData2[0],byteData2[1],'\n'};
      Serial.write(buf,5);
    }
  } else {
    for (i = start; i <= end; i++) {
      serial16Print((buffer1[i]));
      Serial.print(",");
      serial16Print((buffer2[i]));
      Serial.println(",");
    }
  }
}

// CONVERT FLOAT TO HEX AND SEND OVER SERIAL PORT
void serialFloatPrint(float f) {
  byte * b = (byte *) &f;
  for(int i=3; i>=0; i--) {
    
    byte b1 = (b[i] >> 4) & 0x0f;
    byte b2 = (b[i] & 0x0f);
    
    char c1 = (b1 < 10) ? ('0' + b1) : 'A' + b1 - 10;
    char c2 = (b2 < 10) ? ('0' + b2) : 'A' + b2 - 10;
    
    Serial.print(c1);
    Serial.print(c2);
  }
}

// CONVERT Byte TO HEX AND SEND OVER SERIAL PORT
void serialBytePrint(byte b) {
  byte b1 = (b >> 4) & 0x0f;
  byte b2 = (b & 0x0f);

  char c1 = (b1 < 10) ? ('0' + b1) : 'A' + b1 - 10;
  char c2 = (b2 < 10) ? ('0' + b2) : 'A' + b2 - 10;

  Serial.print(c1);
  Serial.print(c2);
}

// CONVERT 16BITS TO HEX AND SEND OVER SERIAL PORT
void serial16Print(uint16_t u) {
  byte * b = (byte *) &u;
  for(int i=1; i>=0; i--) {
    
    byte b1 = (b[i] >> 4) & 0x0f;
    byte b2 = (b[i] & 0x0f);
    
    char c1 = (b1 < 10) ? ('0' + b1) : 'A' + b1 - 10;
    char c2 = (b2 < 10) ? ('0' + b2) : 'A' + b2 - 10;
    
    Serial.print(c1);
    Serial.print(c2);
  }
}

// CONVERT Long TO HEX AND SEND OVER SERIAL PORT
void serialLongPrint(unsigned long l) {
  byte * b = (byte *) &l;
  for(int i=3; i>=0; i--) {
    
    byte b1 = (b[i] >> 4) & 0x0f;
    byte b2 = (b[i] & 0x0f);
    
    char c1 = (b1 < 10) ? ('0' + b1) : 'A' + b1 - 10;
    char c2 = (b2 < 10) ? ('0' + b2) : 'A' + b2 - 10;
    
    Serial.print(c1);
    Serial.print(c2);
  }
}
// Debug ===========================================================

typedef struct  __attribute__((packed, aligned(4))) {
  uint32_t SADDR;
  int16_t SOFF;
  uint16_t ATTR;
  uint32_t NBYTES;
  int32_t SLAST;
  uint32_t DADDR;
  int16_t DOFF;
  uint16_t CITER;
  int32_t DLASTSGA;
  uint16_t CSR;
  uint16_t BITER;
} TCD_DEBUG;

void dumpDMA_TCD(const char *psz, DMABaseClass *dmabc)
{
  Serial.printf("%s %08x %08x:", psz, (uint32_t)dmabc, (uint32_t)dmabc->TCD);
  TCD_DEBUG *tcd = (TCD_DEBUG*)dmabc->TCD;
  Serial.printf("%08x %04x %04x %08x %08x ", tcd->SADDR, tcd->SOFF, tcd->ATTR, tcd->NBYTES, tcd->SLAST);
  Serial.printf("%08x %04x %04x %08x %04x %04x\n", tcd->DADDR, tcd->DOFF, tcd->CITER, tcd->DLASTSGA,
                tcd->CSR, tcd->BITER);

}

static inline void delayNanoseconds(uint32_t) __attribute__((always_inline, unused));
static inline void delayNanoseconds(uint32_t nsec){
    /*
     * Based on Paul Stoffregen's implementation
     * for Teensy 3.0 (http://www.pjrc.com/)
     */
    if (nsec == 0) return;
    uint32_t n = (nsec * 1000) / 35714;
    asm volatile(
        "L_%=_delayNanos:"       "\n\t"
        "subs   %0, #1"                 "\n\t"
        "bne    L_%=_delayNanos" "\n"
        : "+r" (n) :
    );
}
